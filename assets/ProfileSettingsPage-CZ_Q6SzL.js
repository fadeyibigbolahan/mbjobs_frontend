import{c as J,r as i,j as e,B as _,T as q,a as C,u as N,X as H}from"./index-CmvBuaAL.js";import{U as K}from"./user-zK-9aP32.js";import{M as V}from"./mail-D1LFu5P9.js";import{P as W}from"./phone-DlubA-ht.js";import{F as X}from"./file-text-CMd2gL64.js";import{L as D}from"./lock-B1OgRRYi.js";import{E as Q}from"./eye-CQWccWMY.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=J("CircleArrowRight",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]),le=()=>{const[r,h]=i.useState({fullName:"",email:"",phone:"",password:"",confirmPassword:"",profileImage:null,companyName:"",companyLogo:null,bio:"",apprenticeCategories:[]}),[z,F]=i.useState(null),[L,I]=i.useState(null),[u,f]=i.useState(!1),[y,x]=i.useState(""),[b,U]=i.useState(!1),[g,A]=i.useState("apprentice"),[k,E]=i.useState([]),[Z,w]=i.useState(""),[R,j]=i.useState(!1),[l,M]=i.useState(null),T=()=>{const t=new FormData,s={};for(let a in r)r[a]&&(a==="apprenticeCategories"?(r[a].forEach(n=>{t.append("apprenticeCategories[]",n)}),s[a]=r[a]):r[a]instanceof File?(t.append(a,r[a]),s[a]={fileName:r[a].name,fileSize:r[a].size,fileType:r[a].type}):(t.append(a,r[a]),s[a]=r[a]));if(g==="apprentice"&&r.apprenticeCategories.length>0){const a=r.apprenticeCategories.map(n=>{const o=k.find(c=>c._id===n);return o?o.name:n});s.apprenticeCategoryNames=a}M({formData:s,formDataObject:t,userRole:g,timestamp:new Date().toISOString()}),j(!0)},B=async()=>{f(!0),w("");try{const t=localStorage.getItem("authToken"),s=await C.get(`${N}categories`,{headers:{Authorization:t}});console.log("Fetched categories:",s.data),s.data.success?E(s.data.categories):w("Failed to fetch categories")}catch(t){w(t.message||"Failed to fetch categories")}finally{f(!1)}},$=async()=>{try{const t=localStorage.getItem("authToken"),s=await C.get(`${N}users/me`,{headers:{Authorization:t}});console.log("user data",s.data),console.log("Raw apprenticeCategories:",s.data.apprenticeCategories);const a=s.data.apprenticeCategories?s.data.apprenticeCategories.map(n=>n._id||n):[];console.log("Processed apprenticeCategories:",a),A(s.data.role),h(n=>({...n,fullName:s.data.fullName,email:s.data.email,phone:s.data.phone,companyName:s.data.companyName||"",bio:s.data.bio||"",apprenticeCategories:a}))}catch(t){console.error("Error fetching user data:",t)}};i.useEffect(()=>{$(),B()},[]);const m=t=>{const{name:s,value:a,files:n}=t.target;if(n){const o=n[0];h(c=>({...c,[s]:o})),s==="profileImage"?F(URL.createObjectURL(o)):s==="companyLogo"&&I(URL.createObjectURL(o))}else h(o=>({...o,[s]:a}))},G=t=>{h(s=>({...s,apprenticeCategories:s.apprenticeCategories.includes(t)?s.apprenticeCategories.filter(a=>a!==t):[...s.apprenticeCategories,t]}))},P=async t=>{var s,a,n;if(t.preventDefault(),x(""),r.password&&r.password!==r.confirmPassword){x("❌ Passwords do not match.");return}f(!0);try{const o=new FormData;for(let p in r){const d=r[p];d==null||d===""||(p==="apprenticeCategories"?Array.isArray(d)&&d.length>0&&o.append("apprenticeCategories",JSON.stringify(d)):(d instanceof File,o.append(p,d)))}console.log("Form data being sent:"),console.log("FormData entries:");for(let p of o.entries())console.log(p[0]+":",p[1]);const c=localStorage.getItem("authToken");if(console.log("Raw formData state:",r),console.log("Form has entries:",o.has("fullName")),console.log("Authorization token:",c?"Present":"Missing"),!c){x("❌ Authentication token not found. Please log in again.");return}console.log("Sending request to:",`${N}users/me`),console.log("Authorization token:",c?"Present":"Missing");const v=await C.patch(`${N}users/me`,o,{headers:{Authorization:c,"Content-Type":"multipart/form-data"}});console.log("Update response:",v.data),x(v.data.message?`✅ ${v.data.message}`:"✅ Profile updated successfully.")}catch(o){console.error("Update error:",o),console.error("Error response:",(s=o.response)==null?void 0:s.data);const c=((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.message)||o.message||"Something went wrong.";x(`❌ ${c}`)}finally{f(!1)}},S=(t,s,a,n)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a}),e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 dark:bg-slate-800 dark:border-slate-600 dark:hover:bg-slate-700 transition",children:[s?e.jsx("img",{src:s,alt:`${a} Preview`,className:"h-full w-full object-contain rounded-lg"}):e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6 text-center",children:[e.jsx("svg",{className:"w-8 h-8 mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16V4a1 1 0 011-1h8a1 1 0 011 1v12M5 20h14a1 1 0 001-1v-4a1 1 0 00-1-1H5a1 1 0 00-1 1v4a1 1 0 001 1z"})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-300",children:e.jsxs("span",{className:"font-semibold",children:["Click to upload ",a.toLowerCase()]})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n})]}),e.jsx("input",{type:"file",name:t,accept:"image/*",onChange:m,className:"hidden"})]})]}),O=()=>{var t;return!R||!l?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-[#003366]",children:"Data Preview - Before API Submit"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(H,{size:20})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-96",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"User Role:"}),e.jsx("p",{className:"text-sm bg-blue-50 p-2 rounded",children:l.userRole})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Timestamp:"}),e.jsx("p",{className:"text-sm bg-gray-50 p-2 rounded",children:l.timestamp})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Form Data to be sent:"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded text-sm",children:e.jsx("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(l.formData,null,2)})})]}),l.formData.apprenticeCategories&&l.formData.apprenticeCategories.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Selected Categories:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(t=l.formData.apprenticeCategoryNames)==null?void 0:t.map((s,a)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:s},a))})]}),(l.formData.profileImage||l.formData.companyLogo)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"File Uploads:"}),e.jsxs("div",{className:"space-y-2",children:[l.formData.profileImage&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("strong",{children:"Profile Image:"})," ",l.formData.profileImage.fileName," (",(l.formData.profileImage.fileSize/1024).toFixed(2)," ","KB)"]}),l.formData.companyLogo&&e.jsxs("div",{className:"bg-green-50 p-2 rounded text-xs",children:[e.jsx("strong",{children:"Company Logo:"})," ",l.formData.companyLogo.fileName," (",(l.formData.companyLogo.fileSize/1024).toFixed(2)," ","KB)"]})]})]})]})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 text-gray-600 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"Close"}),e.jsx("button",{onClick:()=>{j(!1),P({preventDefault:()=>{}})},disabled:u,className:"px-4 py-2 bg-[#003366] text-white rounded hover:bg-[#004080] transition-colors disabled:opacity-50",children:u?"Submitting...":"Proceed with Submit"})]})})]})})};return e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-center items-start dark:bg-slate-900 min-h-screen p-4",children:[e.jsxs("div",{className:"p-6 mx-auto bg-white shadow rounded w-full max-w-2xl",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h2",{className:"font-kanit mb-2 text-lg font-semibold text-[#003366]",children:"PROFILE SETTINGS"}),e.jsxs("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(K,{size:12,className:"mr-1"}),g==="employer"?"Employer Account":"Apprentice Account"]})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"mb-4 w-full mt-1 rounded border gap-2 p-2 flex items-center",children:[e.jsx(Y,{className:"text-[#003366] flex-shrink-0",size:16}),e.jsx("input",{type:"text",name:"fullName",value:r.fullName,onChange:m,className:"w-full text-sm decoration-none outline-none",placeholder:"Full Name",required:!0})]}),e.jsxs("div",{className:"mb-4 w-full mt-1 rounded border gap-2 p-2 flex items-center",children:[e.jsx(V,{className:"text-[#003366] flex-shrink-0",size:16}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:m,className:"w-full text-sm decoration-none outline-none",placeholder:"Email",required:!0})]})]}),e.jsxs("div",{className:"mb-4 w-full mt-1 rounded border gap-2 p-2 flex items-center",children:[e.jsx(W,{className:"text-[#003366] flex-shrink-0",size:16}),e.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:m,className:"w-full text-sm decoration-none outline-none",placeholder:"Phone Number",required:!0})]}),g==="employer"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-md font-semibold text-[#003366] mb-4",children:"Company Information"}),e.jsxs("div",{className:"mb-4 w-full mt-1 rounded border gap-2 p-2 flex items-center",children:[e.jsx(_,{className:"text-[#003366] flex-shrink-0",size:16}),e.jsx("input",{type:"text",name:"companyName",value:r.companyName,onChange:m,className:"w-full text-sm decoration-none outline-none",placeholder:"Company Name"})]}),e.jsxs("div",{className:"mb-4 w-full mt-1 rounded border gap-2 p-2 flex items-start",children:[e.jsx(X,{className:"text-[#003366] flex-shrink-0 mt-1",size:16}),e.jsx("textarea",{name:"bio",value:r.bio,onChange:m,className:"w-full text-sm decoration-none outline-none resize-none",placeholder:"Company Bio",rows:"3"})]}),e.jsx("div",{className:"mb-4",children:S("companyLogo",L,"Company Logo","PNG, JPG, JPEG (max. 2MB)")})]})}),g==="apprentice"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-md font-semibold text-[#003366] mb-4",children:"Skills & Categories"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(q,{className:"inline mr-1",size:14}),"Select your skill categories"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:k.map(t=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.apprenticeCategories.includes(t._id),onChange:()=>G(t._id),className:"rounded border-gray-300 text-[#003366] focus:ring-[#003366]"}),e.jsx("span",{className:"text-sm text-gray-700",children:t.name})]},t._id))})]})]})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-md font-semibold text-[#003366] mb-4",children:"Change Password"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"mb-4 w-full mt-1 rounded border p-2 flex gap-2 items-center",children:[e.jsx(D,{className:"text-[#003366] flex-shrink-0",size:16}),e.jsx("input",{type:b?"text":"password",name:"password",value:r.password,onChange:m,className:"w-full text-sm decoration-none outline-none",placeholder:"New Password"}),e.jsx("button",{type:"button",onClick:()=>U(!b),className:"text-xs text-[#003366] whitespace-nowrap",children:b?"Hide":"Show"})]}),e.jsxs("div",{className:"mb-4 w-full mt-1 rounded border p-2 flex items-center gap-2",children:[e.jsx(D,{className:"text-[#003366] flex-shrink-0",size:16}),e.jsx("input",{type:b?"text":"password",name:"confirmPassword",value:r.confirmPassword,onChange:m,className:"w-full text-sm decoration-none outline-none",placeholder:"Confirm Password"})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-md font-semibold text-[#003366] mb-4",children:"Profile Picture"}),S("profileImage",z,"Profile Picture","PNG, JPG, JPEG (max. 2MB)")]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:T,className:"flex-1 rounded bg-gray-600 py-3 text-white hover:bg-gray-700 flex justify-center items-center transition-colors duration-200 font-medium",children:[e.jsx(Q,{size:16,className:"mr-2"}),"Preview Data"]}),e.jsx("button",{type:"submit",className:"flex-1 rounded bg-[#003366] py-3 text-white hover:bg-[#004080] flex justify-center items-center transition-colors duration-200 font-medium",disabled:u,children:u?e.jsx("div",{className:"w-5 h-5 border-2 border-t-2 border-white border-t-transparent rounded-full animate-spin"}):"Update Profile"})]}),y&&e.jsx("div",{className:"text-center",children:e.jsx("p",{className:`text-sm mt-2 ${y.includes("✅")?"text-green-600":"text-red-500"}`,children:y})})]})]}),e.jsx(O,{})]})};export{le as default};
