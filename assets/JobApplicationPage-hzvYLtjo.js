import{r as l,d as re,a as N,u as y,j as e,S as $,X as U,M as le,b as ae}from"./index-EQ3434Au.js";import{D as ie}from"./download-D48oYVLs.js";import{F as ne}from"./filter-CtecWEwg.js";import{F as oe}from"./file-text-CI00cckm.js";import{C as de}from"./clock-Bw_PwZMS.js";import{E as J}from"./eye-CzM0WDWE.js";import{C as ce}from"./calendar-zoeUdwnZ.js";import{C as xe}from"./circle-check-big-BP28mVlf.js";import{M as me}from"./mail-mtscdpMx.js";import{M as ue}from"./map-pin-DPvJ2w4Y.js";import{U as he}from"./user-Cg5Knfs5.js";import{M as ge,E as be}from"./message-square-BdRc1T0H.js";import{T as pe,a as je}from"./thumbs-up-BQtVjJf3.js";const Re=()=>{const[d,w]=l.useState(null),[_,S]=l.useState(!1),[q,A]=l.useState(!1),[i,C]=l.useState(null),[c,m]=l.useState(""),[M,k]=l.useState(!1),[T,u]=l.useState([]),[B,L]=l.useState(!1),[h,z]=l.useState([]),[K,j]=l.useState(!0),[R,V]=l.useState(null),[g,H]=l.useState(""),[f,O]=l.useState("All"),[v,X]=l.useState("All"),[n,E]=l.useState([]);l.useState("table");const P=re(),G=async(s,t)=>{console.log("Fetching messages for:",s,t),L(!0);try{const a=localStorage.getItem("authToken"),r=await N.get(`${y}messages/conversation/${s}`,{headers:{Authorization:a,"Content-Type":"application/json"}});console.log("Messages response:",r.data),r.data.success&&u(r.data.messages||[])}catch(a){console.error("Error fetching messages:",a),u([])}finally{L(!1)}},Q=s=>{w(s),S(!0)},F=s=>{C(s),A(!0),m(""),G(s.apprenticeId,s.id)},I=async()=>{if(!(!c.trim()||!i)){console.log("Sending message:",c,"to",i.applicantName),k(!0);try{const s=localStorage.getItem("authToken"),t=await N.post(`${y}messages/send`,{receiverId:i.apprenticeId,content:c,applicationId:i.id},{headers:{"Content-Type":"application/json",Authorization:s}});console.log("Message send response:",t.data),t.data.success?(u(a=>[...a,t.data.message]),alert("Message sent successfully!"),m("")):alert("Failed to send message. Please try again.")}catch(s){console.error("Error sending message:",s),alert("Error sending message. Please try again.")}finally{k(!1)}}},b=()=>{S(!1),A(!1),w(null),C(null),m(""),u([])};l.useEffect(()=>{const s=localStorage.getItem("authToken");if(!s){P("/signin");return}j(!0),N.get(`${y}application/employer`,{headers:{Authorization:s}}).then(t=>{console.log("Fetched applications:",t.data);const a=t.data.applications.map(r=>({id:r._id,applicantName:r.apprentice.fullName,email:r.apprentice.email,phone:"+1 (555) 123-4567",jobTitle:r.job.title,dateApplied:r.createdAt,status:W(r.status),experience:"N/A",location:r.job.location,rating:0,resume:"N/A",coverLetter:r.coverLetter||"Not provided",skills:[],expectedSalary:"N/A",availability:"N/A",apprenticeId:r.apprentice._id,jobId:r.job._id}));z(a),j(!1)}).catch(t=>{console.error("Error fetching data:",t),V("Failed to fetch applications. Please try again."),j(!1)})},[P]);const W=s=>({pending:"Pending",under_review:"Under Review",interview_scheduled:"Interview Scheduled",accepted:"Accepted",rejected:"Rejected"})[s]||"Pending",Y=s=>({Pending:"bg-yellow-100 text-yellow-800 border-yellow-200","Under Review":"bg-blue-100 text-blue-800 border-blue-200","Interview Scheduled":"bg-purple-100 text-purple-800 border-purple-200",Accepted:"bg-green-100 text-green-800 border-green-200",Rejected:"bg-red-100 text-red-800 border-red-200"})[s]||"bg-gray-100 text-gray-800 border-gray-200",Z=[...new Set(h.map(s=>s.jobTitle))],o=h.filter(s=>{const t=s.applicantName.toLowerCase().includes(g.toLowerCase())||s.email.toLowerCase().includes(g.toLowerCase())||s.jobTitle.toLowerCase().includes(g.toLowerCase()),a=f==="All"||s.status===f,r=v==="All"||s.jobTitle===v;return t&&a&&r}),ee=s=>{E(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},se=()=>{E(n.length===o.length?[]:o.map(s=>s.id))},D=(s,t)=>{z(a=>a.map(r=>r.id===s?{...r,status:t}:r))},te=s=>{const t=new Date(s),r=Math.abs(new Date-t),x=Math.ceil(r/(1e3*60*60*24));return x===1?"1 day ago":x<7?`${x} days ago`:x<30?`${Math.floor(x/7)} weeks ago`:t.toLocaleDateString()},p=h.reduce((s,t)=>(s[t.status]=(s[t.status]||0)+1,s),{});return K?e.jsx("div",{className:"max-w-7xl mx-auto p-6 flex justify-center items-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading applications..."})]})}):R?e.jsx("div",{className:"max-w-7xl mx-auto p-6 flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("div",{className:"text-red-600 mb-2",children:"Error"}),e.jsx("p",{className:"text-red-700",children:R}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto md:p-6 text-xs",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Job Applications"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Review and manage candidate applications"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[e.jsx(ie,{size:18}),"Export"]}),e.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-colors",children:[e.jsx(ne,{size:18}),"Advanced Filter"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Applications"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.length})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(oe,{className:"w-5 h-5 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-2 rounded-xl shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:p.Pending||0})]}),e.jsx("div",{className:"bg-yellow-100 p-3 rounded-full",children:e.jsx(de,{className:"w-5 h-5 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-white p-2 rounded-xl shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Under Review"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:p["Under Review"]||0})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(J,{className:"w-5 h-5 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-2 rounded-xl shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Interviews"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:p["Interview Scheduled"]||0})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:e.jsx(ce,{className:"w-5 h-5 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-2 rounded-xl shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Hired"}),e.jsx("p",{className:"text-2xl font-size-600",children:p.Accepted||0})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(xe,{className:"w-5 h-5 text-green-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"p-2 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search by name, email, or job title...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:g,onChange:s=>H(s.target.value)})]}),e.jsxs("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:f,onChange:s=>O(s.target.value),children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Under Review",children:"Under Review"}),e.jsx("option",{value:"Interview Scheduled",children:"Interview Scheduled"}),e.jsx("option",{value:"Accepted",children:"Accepted"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]}),e.jsxs("select",{className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:v,onChange:s=>X(s.target.value),children:[e.jsx("option",{value:"All",children:"All Jobs"}),Z.map(s=>e.jsx("option",{value:s,children:s},s))]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 p-4",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:n.length===o.length&&o.length>0,onChange:se})}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Applicant"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Job Position"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Cover Letter"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-900",children:"Applied"}),e.jsx("th",{className:"text-center p-4 font-semibold text-gray-900",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[o.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:n.includes(s.id),onChange:()=>ee(s.id)})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold",children:s.applicantName.split(" ").map(t=>t[0]).join("")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s.applicantName}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(me,{size:12}),s.email]}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(ue,{size:12}),s.location]})]})]})}),e.jsx("td",{className:"p-4",children:e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900",children:s.jobTitle})})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"text-sm text-gray-900 truncate",title:s.coverLetter,children:s.coverLetter||"No cover letter provided"}),s.coverLetter&&s.coverLetter!=="Not provided"&&e.jsxs("button",{onClick:()=>Q(s),className:"text-blue-600 hover:text-blue-800 text-xs mt-1 flex items-center gap-1",children:[e.jsx(J,{size:12}),"Read full"]})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${Y(s.status)}`,children:s.status})}),e.jsx("td",{className:"p-4 text-gray-600",children:te(s.dateApplied)}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Profile",children:e.jsx(he,{size:16})}),e.jsx("button",{className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Message Applicant",onClick:()=>F(s),children:e.jsx(ge,{size:16})}),e.jsx("button",{className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Accept Application",onClick:()=>D(s.id,"Accepted"),children:e.jsx(pe,{size:16})}),e.jsx("button",{className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Reject Application",onClick:()=>D(s.id,"Rejected"),children:e.jsx(je,{size:16})}),e.jsx("button",{className:"p-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",title:"More Options",children:e.jsx(be,{size:16})})]})})]},s.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-full",children:e.jsx($,{size:24,className:"text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"No applications found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filter criteria"})]})]})})})]})]})}),n.length>0&&e.jsx("div",{className:"p-4 bg-blue-50 border-t border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:[n.length," application",n.length>1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 transition-colors",children:"Accept Selected"}),e.jsx("button",{className:"px-3 py-1 bg-red-600 text-white rounded-md text-sm hover:2z-700 transition-colors",children:"Reject Selected"}),e.jsx("button",{className:"px-3 py-1 bg-purple-600 text-white rounded-md text-sm hover:bg-purple-700 transition-colors",children:"Schedule Interview"})]})]})})]}),_&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Cover Letter - ",d.applicantName]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Application for: ",d.jobTitle]})]}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(U,{size:24})})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-96",children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-gray-900 leading-relaxed",children:d.coverLetter})})}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Close"}),e.jsxs("button",{onClick:()=>{b(),F(d)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(le,{size:16}),"Start Conversation"]})]})})]})}),q&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full mx-4 h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 text-blue-600 rounded-full w-10 h-10 flex items-center justify-center font-semibold",children:i.applicantName.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:i.applicantName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Regarding: ",i.jobTitle]})]})]}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:e.jsx(U,{size:20})})]}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto bg-gray-100",children:B?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):T.length>0?T.map((s,t)=>e.jsx("div",{className:`flex mb-4 ${s.sender.fullName?"justify-end":""}`,children:e.jsxs("div",{className:`max-w-xs rounded-lg px-4 py-2 shadow-sm ${s.sender.fullName?"bg-blue-500 text-white rounded-tr-none":"bg-white rounded-tl-none"}`,children:[e.jsx("p",{className:s.sender.fullName?"text-white":"text-gray-800",children:s.content}),e.jsx("p",{className:`text-xs text-right mt-1 ${s.sender.fullName?"text-blue-100":"text-gray-400"}`,children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},t)):e.jsx("div",{className:"flex justify-center items-center h-full text-gray-500",children:e.jsx("p",{children:"No messages yet. Start the conversation!"})})}),e.jsx("div",{className:"p-3 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("textarea",{value:c,onChange:s=>m(s.target.value),placeholder:"Type your message...",rows:1,className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none max-h-32",onKeyDown:s=>s.key==="Enter"&&!s.shiftKey&&I()}),e.jsx("button",{onClick:I,disabled:!c.trim()||M,className:"p-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:M?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(ae,{size:20,className:"transform -rotate-45"})})]})})]})})]})};export{Re as default};
